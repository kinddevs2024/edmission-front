# EDMISSION — Детальный план фронтенда (V1)

Документ описывает пошаговый план разработки фронтенда платформы Edmission на основе полного блюпринта проекта. Реализация — после утверждения плана.

---

## 1. Стек и окружение

| Категория | Выбор | Обоснование |
|-----------|--------|-------------|
| Сборка | **Vite** | Быстрая сборка, поддержка React из коробки |
| Язык | **TypeScript** | Типобезопасность, лучшая поддержка API-контрактов |
| UI | **React 18+** | По блюпринту |
| Маршрутизация | **React Router v6** | Роль-зависимые маршруты, защищённые роуты |
| Стили | **Tailwind CSS** | Дизайн-токены, быстрая вёрстка, тёмная тема |
| Состояние | **Zustand** | Лёгкий, достаточно для auth + UI, без лишней сложности Redux |
| Запросы к API | **Axios** (инстанс с interceptors) | JWT refresh, единая обработка ошибок |
| Чат | **socket.io-client** | Соответствие бэкенду (Socket.io) |
| Языки | **i18next + react-i18next** | EN / RU / UZ |
| Формы/валидация | **React Hook Form + Zod** | Согласованность с бэкендом (Zod), меньше ре-рендеров |

**Не в MVP:** Redux Toolkit (если позже понадобится — добавить), платная аналитика.

---

## 2. Структура проекта

```
edmission-front/
├── public/
│   ├── favicon.svg
│   └── locales/          # JSON для i18n (en, ru, uz)
├── src/
│   ├── app/               # Инициализация приложения
│   │   ├── App.tsx
│   │   ├── Router.tsx     # Роль-зависимые роуты
│   │   └── providers.tsx  # Theme, i18n, Auth, Query
│   ├── pages/
│   │   ├── auth/          # Логин, регистрация, forgot password, verify email
│   │   ├── student/       # Все страницы студента
│   │   ├── university/    # Все страницы университета
│   │   └── admin/         # Все страницы админа
│   ├── components/
│   │   ├── ui/            # Базовые: Button, Input, Card, Badge, Modal, Table, etc.
│   │   ├── layout/        # Sidebar, TopBar, MainLayout, AuthLayout
│   │   ├── student/       # UniversityCard, ApplicationRow, OfferCard, CompareTable
│   │   ├── university/    # StudentCard, PipelineColumn, ScholarshipRow
│   │   ├── admin/         # VerificationCard, UserTable
│   │   ├── chat/          # ChatList, MessageThread, MessageBubble
│   │   └── ai/            # FloatingAIButton, AIChatDrawer
│   ├── layouts/
│   │   ├── MainLayout.tsx       # Sidebar + TopBar + outlet
│   │   ├── StudentLayout.tsx    # Студент-специфичное меню
│   │   ├── UniversityLayout.tsx
│   │   ├── AdminLayout.tsx
│   │   └── AuthLayout.tsx
│   ├── hooks/
│   │   ├── useAuth.ts
│   │   ├── useTheme.ts
│   │   ├── useSocket.ts
│   │   ├── useRecommendations.ts
│   │   └── ...
│   ├── services/
│   │   ├── api.ts         # Axios instance, interceptors
│   │   ├── auth.ts
│   │   ├── student.ts
│   │   ├── university.ts
│   │   ├── chat.ts
│   │   ├── ai.ts
│   │   └── notifications.ts
│   ├── store/
│   │   ├── authStore.ts
│   │   ├── uiStore.ts     # sidebar collapsed, modals
│   │   └── notificationStore.ts
│   ├── utils/
│   │   ├── format.ts      # даты, числа
│   │   ├── constants.ts  # статусы, enum-маппинги
│   │   └── cn.ts         # classnames helper
│   ├── i18n/
│   │   ├── index.ts
│   │   └── config.ts
│   ├── types/
│   │   ├── api.ts
│   │   ├── user.ts
│   │   ├── student.ts
│   │   ├── university.ts
│   │   └── chat.ts
│   ├── styles/
│   │   └── index.css     # Tailwind + CSS variables для темы
│   ├── main.tsx
│   └── vite-env.d.ts
├── .env.example
├── tailwind.config.js
├── tsconfig.json
├── vite.config.ts
└── package.json
```

---

## 3. Дизайн-система (настройка под блюпринт)

### 3.1 Цвета (CSS variables + Tailwind)

- **Primary Dark (sidebar/nav):** `#0F172A`
- **Primary Accent (CTA):** `#84CC16` (Soft Lime)
- **Secondary:** `#1E293B`
- Light: bg `#F8FAFC`, card `#FFFFFF`, border `#E5E7EB`, text `#0F172A` / `#475569`
- Dark: bg `#0F172A`, card `#111827`, border `#1F2937`, text `#F9FAFB` / `#CBD5E1`
- Статусы: Accepted `#22C55E`, Under Review `#3B82F6`, Offer Sent `#84CC16`, Rejected `#64748B`

### 3.2 Типографика

- Шрифт: **Inter** или **Manrope** (Google Fonts).
- H1: 32–40px, H2: 24–28px, H3: 18–20px, body 14–16px.
- Weights: 600 — заголовки, 500 — лейблы, 400 — текст.

### 3.3 Сетка и отступы

- База 8px.
- Sidebar: 240–260px.
- Контент: max-width 1200–1400px, центрирование.
- Радиусы: 12px (кнопки/инпуты), 16px (карточки), pill для бейджей.

### 3.4 Компоненты UI (первая очередь)

- **Button:** Primary (lime), Secondary (outline), Ghost.
- **Input:** текст, с лейблом и состоянием ошибки/успеха.
- **Select:** одиночный и мульти (для фильтров), с поиском где нужно.
- **Card:** базовая карточка с тенью и радиусом.
- **Badge:** статус, scholarship, verified, match %.
- **Table:** сортировка, пагинация, пустое состояние.
- **Modal:** заголовок, тело, кнопки действий.
- **Skeleton:** карточка, таблица, профиль.
- **Toast:** уведомления (success, info, warning, error), top-right.
- **MatchScore:** круг/бар/компактный бейдж + тултип с breakdown.

Далее: форма-степпер (онбординг университета), Kanban-колонки, графики (линия, бар, воронка, донат).

---

## 4. Аутентификация и доступ

### 4.1 Сценарий

1. Логин → POST с email/password.
2. Бэкенд отдаёт access token (в теле или заголовке) и refresh token (в httpOnly cookie или теле — по решению бэка).
3. Access храним в памяти (Zustand), при необходимости — кратковременно в sessionStorage только для восстановления при перезагрузке (по политике безопасности).
4. Axios interceptor: при 401 — запрос refresh → повтор исходного запроса.
5. Роль приходит в JWT или отдельным полем в ответе логина; сохраняем в store.
6. Роуты защищены по роли: `/student/*`, `/university/*`, `/admin/*`.

### 4.2 Страницы auth

- `/login` — форма логина.
- `/register` — выбор роли (student / university) + форма регистрации.
- `/forgot-password` — ввод email, сообщение «проверьте почту».
- `/verify-email` — страница после перехода по ссылке (успех/ошибка).
- `/reset-password?token=...` — новый пароль (если бэкенд поддерживает).

После логина редирект: студент → `/student/dashboard`, университет → `/university/dashboard`, админ → `/admin`.

### 4.3 Общие для всех ролей

- Профиль: просмотр/редактирование (имя, аватар, настройки).
- Настройки: смена пароля, безопасность (сессии при необходимости).
- Переключатель темы (light/dark), переключатель языка (EN/RU/UZ).
- Уведомления (иконка в TopBar, выпадающий список, «пометить прочитанным»).

---

## 5. Студент — страницы и функции

### 5.1 Dashboard (`/student/dashboard`)

- Блок завершённости профиля (progress bar, %).
- Блок «AI Insight» (краткий текст/совет от AI, если API готов).
- Рекомендованные университеты (топ 5 по match_score), карточки с Match % и CTA «Подробнее» / «Интерес».
- Активные заявки (таблица: университет, статус, дата, действие).
- Полученные офферы (карточки с Accept/Decline).
- Активные чаты (ссылки на чат).
- Быстрые действия: «Искать университеты», «Мои заявки», «Чаты».

Метрики в виде небольших карточек: количество заинтересованных вузов, активных чатов, офферов, принятых офферов.

### 5.2 Explore Universities (`/student/universities`)

- Слева: фильтры (страна, город, степень, направление, диапазон tuition, наличие стипендии, язык, рейтинг, тип кампуса). Сохранять состояние фильтров в URL (query) для шаринга и возврата.
- Справа: сетка карточек университетов.
- Сортировка по умолчанию: Match Score DESC (если пользователь залогинен и есть рекомендации).
- Карточка: лого, название, страна·город, краткое описание, бейдж стипендии, Match % (если есть), кнопки «Интерес», «Подробнее».
- Пагинация или бесконечный скролл (по решению).
- Пустое состояние: «Нет университетов по выбранным фильтрам».

### 5.3 University Detail (`/student/universities/:id`)

- Полная информация по вузу (обзор, медиа, программы, кампус, контакты).
- Match % и breakdown (если есть).
- Кнопки: «Проявить интерес», «Написать», «Добавить к сравнению».

### 5.4 Applications (`/student/applications`)

- Таблица: университет, статус (Interested / Under Review / Chat Opened / Offer Sent / Rejected / Accepted), дата, последнее обновление, действие (открыть чат, перейти к офферу).
- Фильтр по статусу, пагинация.
- Цветовые бейджи статусов по дизайн-системе.

### 5.5 Offers (`/student/offers`)

- Карточки офферов: университет, тип стипендии (Full/Partial/Budget), покрытие %, дедлайн.
- Кнопки Accept / Decline.
- Ургентный бейдж, если до дедлайна < 3 дней.
- Пустое состояние с CTA «Исследуйте университеты».

### 5.6 Compare (`/student/compare`)

- Выбор до 3–4 университетов из «интересных» или из списка сохранённых для сравнения.
- Таблица сравнения: tuition, стипендия, рейтинг, локация, степень, программы, язык, кол-во студентов, тип кампуса.
- Под каждой колонкой — основное действие (перейти в детали / подать интерес).

### 5.7 Chat (`/student/chat`)

- Split: слева список чатов (с университетами), справа выбранный тред.
- В списке: аватар/лого вуза, название, последнее сообщение, время, индикатор непрочитанного.
- В треде: сообщения (студент — справа, вуз — слева), время, опционально «прочитано».
- Поле ввода + отправка; при необходимости — индикатор набора.
- На мобильном: список или тред на весь экран с переключением.

---

## 6. Университет — страницы и функции

### 6.1 Первый вход (онбординг)

Многошаговая форма (степпер):

1. **Overview:** название, лого, слоган, год основания, кол-во студентов, аккредитация, рейтинг, описание.
2. **Media & Location:** фото кампуса, видео, страна, город, карта.
3. **Programs & Academics:** степени, направления, tuition, длительность, язык, вступительные требования.
4. **Campus Life & Services:** жильё, клубы, объекты, поддержка студентов.
5. **Contact & Review:** email, телефон, соцсети, финальный просмотр и отправка.

После успешной отправки — переход в dashboard. Флаг «онбординг пройден» хранится на бэкенде/профиле.

### 6.2 Dashboard (`/university/dashboard`)

- Метрики (карточки): новые заинтересованные, активные чаты, отправленные офферы, acceptance rate, распределение стипендий.
- Воронка: Interested → Contacted → Evaluating → Offer Sent → Accepted (визуализация кол-ва по этапам).
- Список последних студентов (краткие карточки с переходом в Discovery или Pipeline).

### 6.3 Discovery (`/university/students`)

- Слева: фильтры (класс/курс, GPA, направление, уровень языка, страна, % заполнения портфолио).
- Справа: сетка карточек студентов (аватар, имя, класс, GPA, направление, % портфолио, Match %, «Портфолио», «Открыть чат»).
- Сортировка по Match Score DESC по умолчанию.

### 6.4 Pipeline (`/university/pipeline`)

- Kanban: колонки Interested, Contacted, Evaluating, Offer Sent, Accepted, Rejected.
- В каждой колонке — карточки студентов (компактно: имя, вуз/направление если нужно, дата). В будущем — drag-and-drop между колонками (сейчас можно только отображать и открывать карточку/чат).

### 6.5 Scholarships (`/university/scholarships`)

- Таблица: название, покрытие %, макс. слотов, остаток, дедлайн, условия (eligibility).
- Визуализация: прогресс заполнения слотов, бейдж «осталось X».
- Кнопка «Создать стипендию» → модалка/страница с формой.
- Блок аналитики: распределение, приёмность (если API отдаёт).

### 6.6 Analytics (`/university/analytics`)

- Графики: рост интереса по времени, конверсия офферов, география, эффективность стипендий.
- Компоненты: Line, Bar, Funnel, Donut (библиотека — Recharts или Chart.js, стилизовать под дизайн-систему).

### 6.7 Chat (`/university/chat`)

- Та же схема, что у студента: список чатов (со студентами), тред справа. Роль отправителя определяет выравнивание сообщения.

### 6.8 Редактирование профиля

- Страница/раздел настроек университета: редактирование тех же блоков, что и в онбординге (обзор, медиа, программы, кампус, контакты), без обязательного степпера.

---

## 7. Админ — страницы и функции

### 7.1 Dashboard (`/admin` или `/admin/dashboard`)

- Карточки: всего студентов, всего университетов, активных офферов, состояние системы (health).
- Краткие таблицы или ссылки: последние регистрации, очередь верификации.

### 7.2 User Management (`/admin/users`)

- Таблица пользователей: email, роль, дата регистрации, статус (активен/заблокирован).
- Действия: Suspend/Unsuspend, просмотр активности при необходимости.

### 7.3 University Verification (`/admin/verification`)

- Очередь вузов на верификацию: карточки с основными данными и документами.
- Кнопки Approve / Reject с возможностью комментария (если API поддерживает).

### 7.4 Scholarship Monitoring (`/admin/scholarships`)

- Сводка по стипендиям по вузам: использование слотов, дедлайны (только просмотр или с возможностью предупреждений — по API).

### 7.5 Logs (`/admin/logs`)

- Аудит-логи: таблица с фильтрами по дате, типу события, пользователю (по тому, что отдаёт бэкенд).

### 7.6 Support Tickets (`/admin/support`) — по возможности в MVP

- Список тикетов, статус, назначение (если есть на бэке).

### 7.7 System Health (`/admin/health`)

- Отображение статуса сервисов (API, БД, воркеры), если бэкенд даёт endpoint.

---

## 8. Глобальные фичи

### 8.1 Тема (Light / Dark)

- Класс на `html` или обёртке: `light` / `dark`.
- CSS-переменные переключаются в зависимости от темы.
- Состояние темы в Zustand + сохранение в localStorage; переключатель в TopBar.

### 8.2 Языки (EN / RU / UZ)

- i18next: namespace по разделам (common, auth, student, university, admin).
- Файлы в `public/locales/{lang}/...json`.
- Переключатель в TopBar; язык в store и localStorage.
- Форматирование дат/чисел по локали (Intl или dayjs с locale).

### 8.3 Уведомления

- Иконка в TopBar, счётчик непрочитанных.
- Выпадающий список: последние N уведомлений, типы (offer, message, status_update), «отметить прочитанным».
- При наличии WebSocket — подписка на канал уведомлений и обновление в реальном времени.
- Toast для локальных событий (успех сохранения, ошибка формы).

### 8.4 Верификация email

- После регистрации — сообщение «Проверьте почту».
- Страница `/verify-email` обрабатывает переход по ссылке и показывает успех/ошибку; при успехе — редирект в личный кабинет.

### 8.5 Адаптивность

- Breakpoints: 768px (mobile), 1024px (tablet), 1440px (desktop).
- Desktop: полный сайдбар.
- Tablet: сайдбар свёрнут в иконки, подсказки по hover.
- Mobile: нижняя навигация (основные разделы), чат и фильтры — на полноэкранных экранах/модалках.

---

## 9. AI-ассистент

- Плавающая кнопка (низ справа) на всех страницах.
- По клику — выезжающая панель (drawer): заголовок «Edmission AI», блок предлагаемых вопросов, история сообщений, поле ввода.
- Запросы на `POST /api/ai/chat`; контекст собирается на бэкенде.
- Индикатор «печатает» во время ответа; при лимите бесплатного тира — текст/индикатор (если API отдаёт).

---

## 10. Чат (WebSocket)

- Подключение socket.io-client после успешного логина; передача токена (query или auth event).
- Комнаты по `chat_id`; события: новое сообщение, прочитано, typing (опционально).
- Сохранение истории через API при загрузке страницы чата; новые сообщения — через сокет, дубликаты не показывать.
- Переподключение при потере связи; очередь сообщений при офлайне — по желанию (можно отложить на пост-MVP).

---

## 11. API и типы (предположения для фронта)

- Базовый URL: `import.meta.env.VITE_API_URL`.
- Все запросы с заголовком `Authorization: Bearer <access_token>` (кроме логина, регистрации, forgot-password, verify-email).
- Типы (TypeScript): User, StudentProfile, UniversityProfile, Program, Scholarship, Interest, Offer, Chat, Message, Recommendation (match_score, breakdown), Notification.
- Пагинация: единый формат (например, `page`, `limit`, ответ `{ data, total, page }`).
- Ошибки: единый формат `{ message, code, errors? }`; отображение через toast или inline в формах.

Контракт по эндпоинтам будет уточнён при разработке бэкенда; фронт готов под типичные REST + WebSocket.

---

## 12. Этапы реализации (по приоритету)

### Фаза 0 — Подготовка (до разработки страниц)

1. Инициализация Vite + React + TypeScript.
2. Подключение Tailwind, настройка дизайн-токенов (цвета, шрифты, отступы).
3. Базовая структура папок, роутер (без защищённых маршрутов), заглушки layout.
4. i18n: конфиг + 3 языка, ключи common + auth.
5. Тема: переключатель + CSS variables.
6. Axios instance + interceptors (без реального refresh пока).
7. Zustand: authStore (user, token, role, setUser, logout), uiStore, notificationStore (заглушка).

### Фаза 1 — Auth и общее

8. Страницы: Login, Register (student/university), Forgot Password, Verify Email.
9. Защита роутов: редирект неавторизованных на `/login`, авторизованных по роли — на свой dashboard.
10. Layouts: AuthLayout, MainLayout (Sidebar + TopBar), ролевые обёртки (StudentLayout, UniversityLayout, AdminLayout).
11. Базовые UI-компоненты: Button, Input, Card, Badge, Modal, Table (с пагинацией), Skeleton, Toast.
12. Профиль и настройки (общая страница): отображение данных, смена пароля, тема, язык.

### Фаза 2 — Студент (ядро)

13. Student Dashboard: блоки по макету, запросы рекомендаций и заявок/офферов (если API готовы).
14. Explore Universities: фильтры, список университетов, карточка университета (UniversityCard), сортировка по match.
15. University Detail: полная страница вуза, кнопка «Интерес».
16. Applications: таблица со статусами и действиями.
17. Offers: карточки офферов, Accept/Decline.
18. Compare: выбор вузов и таблица сравнения.
19. Компонент MatchScore (круг/бар/бейдж + тултип).

### Фаза 3 — Университет (ядро)

20. Онбординг университета: степпер из 5 шагов, сохранение по шагам или в конце.
21. University Dashboard: метрики, воронка, последние студенты.
22. Discovery: фильтры, студенческие карточки, Match %.
23. Pipeline: Kanban-колонки и карточки (без drag пока).
24. Scholarships: таблица, создание/редактирование стипендии (модалка или страница).
25. Analytics: графики (Recharts): интерес, конверсия, регионы, стипендии.
26. Редактирование профиля университета.

### Фаза 4 — Чат и уведомления

27. WebSocket: подключение, комнаты по chat_id, события сообщений/прочитано.
28. Chat UI: общий компонент (список + тред), страницы `/student/chat` и `/university/chat`.
29. Уведомления: API списка + пометить прочитанным, иконка и выпадающий список в TopBar; при наличии — real-time через сокет.

### Фаза 5 — Админ и AI

30. Admin: dashboard, User Management, University Verification, Scholarship Monitoring, Logs, System Health (и Support при наличии API).
31. AI-ассистент: кнопка, drawer, запросы к `/api/ai/chat`, предложенные вопросы, индикатор набора.

### Фаза 6 — Полировка

32. Пустые и ошибочные состояния на всех страницах.
33. Загрузки: скелетоны везде, где списки/карточки.
34. Адаптив: сайдбар, нижняя навигация, чат и фильтры на мобильных.
35. Доступность: фокус, ARIA, контраст (WCAG AA).
36. E2E или критические сценарии (по желанию): логин, переход по ролям, одна заявка студента.

---

## 13. Риски и зависимости

- **Бэкенд:** фронт может стартовать с моками (MSW или статичные JSON) для dashboard, списков и карточек; после появления API — переключение на реальные вызовы.
- **Чат:** полная реализация зависит от Socket.io на бэке и схемы событий.
- **AI:** доступность Ollama и роутинг на бэке; на фронте — только вызов одного эндпоинта и отображение ответа.
- **Верификация университетов:** экран админа зависит от API документов и статусов верификации.

---

## 14. Итоговый чеклист перед стартом разработки

- [ ] Утвердить этот план (объём и порядок фаз).
- [ ] Определить формат API (REST base URL, формат пагинации, ошибок, refresh token).
- [ ] Создать репозиторий/ветку для фронта и завести задачи по фазам.
- [ ] После фазы 0 — согласовать дизайн-токены и несколько экранов (Figma или статичные макеты при наличии).

План готов к использованию для пошаговой реализации фронтенда Edmission. После утверждения можно переходить к Фазе 0 и далее по списку.
